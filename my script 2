-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer
local chr = lp.Character or lp.CharacterAdded:Wait()
local hum = chr:WaitForChild("Humanoid")

-- Flags
local isAimbotEnabled = false
local lockedTarget = nil
local aimCircle = nil
local isShooting = false

-- UI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BIGNICKOZZZ_ScriptUI"
screenGui.ResetOnSpawn = false
screenGui.Enabled = false
screenGui.Parent = lp:WaitForChild("PlayerGui")

-- Main Frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 300, 0, 180)
frame.Position = UDim2.new(0.5, -150, 0.5, -90)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

-- Title Text
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(0, 300, 0, 30)
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 18
titleLabel.Text = "BIGNICKOZZZ SCRIPT"
titleLabel.TextScaled = true
titleLabel.Parent = frame

-- Aimbot Button
local aimbotButton = Instance.new("TextButton")
aimbotButton.Size = UDim2.new(0, 250, 0, 40)
aimbotButton.Position = UDim2.new(0, 25, 0, 90)
aimbotButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
aimbotButton.TextColor3 = Color3.fromRGB(255, 255, 255)
aimbotButton.Font = Enum.Font.SourceSansBold
aimbotButton.TextSize = 16
aimbotButton.Text = "Aimbot: Disabled"
aimbotButton.Parent = frame

-- Close (X) Button
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 25, 0, 25)
closeButton.Position = UDim2.new(1, -30, 0, 5)
closeButton.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
closeButton.TextColor3 = Color3.new(1, 1, 1)
closeButton.Font = Enum.Font.SourceSansBold
closeButton.TextSize = 16
closeButton.Text = "X"
closeButton.Parent = frame

-- Aimbot Button Functionality
aimbotButton.MouseButton1Click:Connect(function()
	isAimbotEnabled = not isAimbotEnabled
	aimbotButton.Text = isAimbotEnabled and "Aimbot: Enabled" or "Aimbot: Disabled"
	aimbotButton.BackgroundColor3 = isAimbotEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
end)

-- Close Button Functionality
closeButton.MouseButton1Click:Connect(function()
	screenGui:Destroy()
end)

-- Toggle UI Visibility with M key
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if not gameProcessed and input.KeyCode == Enum.KeyCode.M then
		screenGui.Enabled = not screenGui.Enabled
	end
end)

-- Aimbot Logic (Lock onto player's head)
task.spawn(function()
	while true do
		task.wait(0.1)

		if isAimbotEnabled then
			-- Find the nearest player to lock onto
			local closestTarget = nil
			local shortestDistance = math.huge
			for _, player in pairs(Players:GetPlayers()) do
				if player ~= lp and player.Character and player.Character:FindFirstChild("Head") then
					local targetPos = player.Character.Head.Position
					local distance = (chr.HumanoidRootPart.Position - targetPos).Magnitude

					if distance < shortestDistance then
						closestTarget = player
						shortestDistance = distance
					end
				end
			end

			if closestTarget then
				-- Lock onto the closest player's head
				local head = closestTarget.Character:FindFirstChild("Head")
				if head then
					-- Show a purple circle above the target's head to indicate lock-on
					if not aimCircle then
						aimCircle = Instance.new("Part")
						aimCircle.Shape = Enum.PartType.Ball
						aimCircle.Size = Vector3.new(1, 1, 1)
						aimCircle.Color = Color3.fromRGB(255, 0, 255)  -- Purple
						aimCircle.Anchored = true
						aimCircle.CanCollide = false
						aimCircle.Parent = Workspace
					end

					aimCircle.Position = head.Position + Vector3.new(0, 1, 0)  -- Slightly above the head

					-- Store the locked target
					lockedTarget = closestTarget
				end
			end
		end
	end
end)

-- Left Mouse Button (LMB) to manually shoot towards the locked target
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if not gameProcessed and input.UserInputType == Enum.UserInputType.MouseButton1 then
		-- When Left Mouse Button (LMB) is pressed, shoot towards the locked target's head
		if lockedTarget and lockedTarget.Character and lockedTarget.Character:FindFirstChild("Head") then
			local targetHead = lockedTarget.Character.Head
			-- Shoot towards the locked target's head
			local ray = Ray.new(chr.HumanoidRootPart.Position, (targetHead.Position - chr.HumanoidRootPart.Position).unit * 500)
			local hitPart, hitPosition = Workspace:FindPartOnRay(ray, chr)

			if hitPart and hitPart.Parent == lockedTarget.Character then
				-- Successfully hit the locked target's head, simulate gunshot hit
				print("Shot fired at target head!")
				-- You can add a shooting effect here (e.g., particle effects or damage logic)
			end
		end
	end
end)

-- Right Mouse Button (RMB) to lock onto the target without shooting
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if not gameProcessed and input.UserInputType == Enum.UserInputType.MouseButton2 then
		-- When RMB is pressed, lock on to the target's head (this doesn't fire)
		if lockedTarget and lockedTarget.Character and lockedTarget.Character:FindFirstChild("Head") then
			local targetHead = lockedTarget.Character.Head
			-- Aim at the locked target's head
			chr:LookAt(targetHead.Position)
			print("Locked onto target's head")
		end
	end
end)

-- Character reset handler
lp.CharacterAdded:Connect(function(newChar)
	chr = newChar
	hum = chr:WaitForChild("Humanoid")
end)
