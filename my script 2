-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")

local lp = Players.LocalPlayer
local mouse = lp:GetMouse()
local chr = lp.Character or lp.CharacterAdded:Wait()
local hum = chr:WaitForChild("Humanoid")

-- Flags
local skyEnabled = false
local aimbotEnabled = false
local isRunning = true
local lockedTarget = nil
local walkSpeed = 16  -- Default walk speed

-- UI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BIGNICKOZZZ_GUI"
screenGui.ResetOnSpawn = false
screenGui.Enabled = true
screenGui.Parent = lp:WaitForChild("PlayerGui")

local uiCorner = Instance.new("UICorner")
local function createButton(text)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 40)
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.Text = text
    uiCorner:Clone().Parent = btn
    return btn
end

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 260, 0, 260) -- Increased the height for extra features
mainFrame.Position = UDim2.new(0.5, -130, 0.5, -130)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.Active = true
mainFrame.Draggable = true
uiCorner.Parent = mainFrame
mainFrame.Parent = screenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255, 80, 255)
title.Text = "BIGNICKOZZZ SCRIPT"
title.Font = Enum.Font.GothamBlack
title.TextSize = 20
title.Parent = mainFrame

local skyButton = createButton("Sky: Disabled")
skyButton.Position = UDim2.new(0, 10, 0, 50)
skyButton.Parent = mainFrame

local aimbotButton = createButton("Aimbot: Disabled")
aimbotButton.Position = UDim2.new(0, 10, 0, 100)
aimbotButton.Parent = mainFrame

local walkSpeedBox = Instance.new("TextBox")
walkSpeedBox.Size = UDim2.new(0, 200, 0, 40)
walkSpeedBox.Position = UDim2.new(0, 10, 0, 150)
walkSpeedBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
walkSpeedBox.TextColor3 = Color3.fromRGB(255, 255, 255)
walkSpeedBox.Font = Enum.Font.GothamBold
walkSpeedBox.TextSize = 16
walkSpeedBox.Text = tostring(walkSpeed)
walkSpeedBox.Parent = mainFrame

local closeButton = createButton("Close")
closeButton.Position = UDim2.new(0, 10, 0, 200)
closeButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
closeButton.Parent = mainFrame

-- Button Logic
skyButton.MouseButton1Click:Connect(function()
    skyEnabled = not skyEnabled
    skyButton.Text = skyEnabled and "Sky: Enabled" or "Sky: Disabled"
end)

aimbotButton.MouseButton1Click:Connect(function()
    aimbotEnabled = not aimbotEnabled
    aimbotButton.Text = aimbotEnabled and "Aimbot: Enabled" or "Aimbot: Disabled"
end)

-- Update walk speed based on input
walkSpeedBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        local newSpeed = tonumber(walkSpeedBox.Text)
        if newSpeed then
            walkSpeed = newSpeed
            hum.WalkSpeed = walkSpeed  -- Apply new walk speed to the character
        else
            walkSpeedBox.Text = tostring(walkSpeed)  -- Reset to previous speed if invalid
        end
    end
end)

closeButton.MouseButton1Click:Connect(function()
    isRunning = false
    screenGui:Destroy()
end)

-- Toggle UI visibility using "M" key
UserInputService.InputBegan:Connect(function(input, processed)
    if not processed and input.KeyCode == Enum.KeyCode.M then
        screenGui.Enabled = not screenGui.Enabled
    end
end)

-- Sky Bypass Logic
local function isValidSkyPosition(pos)
    local region = Region3.new(pos - Vector3.new(1, 1, 1), pos + Vector3.new(1, 1, 1))
    local parts = Workspace:FindPartsInRegion3(region, nil, math.huge)
    return #parts == 0
end

task.spawn(function()
    while isRunning do
        task.wait(0.2)
        if not skyEnabled or not hum or hum.Health > 25 then continue end

        local hrp = chr:FindFirstChild("HumanoidRootPart")
        if hrp then
            local pos = hrp.Position
            local newPos = Vector3.new(pos.X + math.random(-1, 1), 10, pos.Z + math.random(-1, 1))
            if isValidSkyPosition(newPos) then
                chr:PivotTo(CFrame.new(newPos))
            end
        end
    end
end)

-- Aimbot Visual Marker
local aimMarker = Instance.new("Part")
aimMarker.Anchored = true
aimMarker.CanCollide = false
aimMarker.Shape = Enum.PartType.Ball
aimMarker.Size = Vector3.new(0.5, 0.5, 0.5)
aimMarker.BrickColor = BrickColor.new("Royal purple")
aimMarker.Material = Enum.Material.Neon
aimMarker.Transparency = 0.3
aimMarker.Name = "AimMarker"
aimMarker.Parent = Workspace

-- Get Closest Player within 15 studs
local function getClosestPlayer()
    local closest, distance = nil, math.huge
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= lp and plr.Character and plr.Character:FindFirstChild("Head") then
            local head = plr.Character.Head
            local screenPoint, onScreen = Workspace.CurrentCamera:WorldToViewportPoint(head.Position)
            if onScreen then
                local dist = (Vector2.new(mouse.X, mouse.Y) - Vector2.new(screenPoint.X, screenPoint.Y)).Magnitude
                if dist < distance and dist < 15 then  -- Target only if within 15 studs
                    closest = head
                    distance = dist
                end
            end
        end
    end
    return closest
end

-- Aimbot Logic
UserInputService.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 and aimbotEnabled then
        lockedTarget = getClosestPlayer()
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        lockedTarget = nil
        aimMarker.Position = Vector3.new(0, -9999, 0)
    end
end)

RunService.RenderStepped:Connect(function()
    if lockedTarget and lockedTarget.Parent then
        local cam = Workspace.CurrentCamera
        local targetPos = lockedTarget.Position + Vector3.new(0, 0.1, 0)
        cam.CFrame = CFrame.new(cam.CFrame.Position, targetPos)
        aimMarker.Position = targetPos
    end
end)

-- Character Reset
lp.CharacterAdded:Connect(function(newChar)
    chr = newChar
    hum = chr:WaitForChild("Humanoid")
end)
