-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")

local lp = Players.LocalPlayer
local mouse = lp:GetMouse()
local chr = lp.Character or lp.CharacterAdded:Wait()
local hum = chr:WaitForChild("Humanoid")

-- Flags
local skyEnabled = false
local aimbotEnabled = false
local isRunning = true
local lockedTarget = nil
local espHighlight = nil

-- UI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BIGNICKOZZZ_GUI"
screenGui.ResetOnSpawn = false
screenGui.Enabled = true
screenGui.Parent = lp:WaitForChild("PlayerGui")

local uiCorner = Instance.new("UICorner")
local function createButton(text)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 40)
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.Text = text
    uiCorner:Clone().Parent = btn
    return btn
end

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 260, 0, 220)
mainFrame.Position = UDim2.new(0.5, -130, 0.5, -110)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.Active = true
mainFrame.Draggable = true
uiCorner.Parent = mainFrame
mainFrame.Parent = screenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255, 80, 255)
title.Text = "BIGNICKOZZZ SCRIPT"
title.Font = Enum.Font.GothamBlack
title.TextSize = 20
title.Parent = mainFrame

local skyButton = createButton("Sky: Disabled")
skyButton.Position = UDim2.new(0, 10, 0, 50)
skyButton.Parent = mainFrame

local aimbotButton = createButton("Aimbot: Disabled")
aimbotButton.Position = UDim2.new(0, 10, 0, 100)
aimbotButton.Parent = mainFrame

local closeButton = createButton("Close")
closeButton.Position = UDim2.new(0, 10, 0, 150)
closeButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
closeButton.Parent = mainFrame

-- Button Logic
skyButton.MouseButton1Click:Connect(function()
    skyEnabled = not skyEnabled
    skyButton.Text = skyEnabled and "Sky: Enabled" or "Sky: Disabled"
end)

aimbotButton.MouseButton1Click:Connect(function()
    aimbotEnabled = not aimbotEnabled
    aimbotButton.Text = aimbotEnabled and "Aimbot: Enabled" or "Aimbot: Disabled"
end)

closeButton.MouseButton1Click:Connect(function()
    isRunning = false
    screenGui:Destroy()
end)

-- Toggle UI
UserInputService.InputBegan:Connect(function(input, processed)
    if not processed and input.KeyCode == Enum.KeyCode.M then
        screenGui.Enabled = not screenGui.Enabled
    end
end)

-- Sky Loop Anti-Kill
local function isValidSkyPosition(pos)
    local region = Region3.new(pos - Vector3.new(1, 1, 1), pos + Vector3.new(1, 1, 1))
    local parts = Workspace:FindPartsInRegion3(region, nil, math.huge)
    return #parts == 0
end

task.spawn(function()
    while isRunning do
        task.wait(0.2)
        if skyEnabled and hum and hum.Health <= 25 then
            local hrp = chr:FindFirstChild("HumanoidRootPart")
            if hrp then
                local pos = hrp.Position
                local newPos = Vector3.new(pos.X, pos.Y + 15, pos.Z)
                if isValidSkyPosition(newPos) then
                    chr:PivotTo(CFrame.new(newPos))
                end
            end
        end
    end
end)

-- Speed and Jump Buff
hum.WalkSpeed = 30
hum.JumpPower = 100


-- ESP Management
local function createHighlight(targetModel)
    local highlight = Instance.new("Highlight")
    highlight.Adornee = targetModel
    highlight.FillColor = Color3.fromRGB(128, 0, 255)
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 1
    highlight.Parent = targetModel
    return highlight
end

local function removeHighlight()
    if espHighlight then
        espHighlight:Destroy()
        espHighlight = nil
    end
end

local holdingRightMouse = false
local lastMousePosition = Vector2.new()
local stillTime = 0
local lockDelay = 0.15  -- seconds mouse must stay still before hard lock
local aimPart = "Head"

-- Detect RMB held
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        holdingRightMouse = true
        stillTime = 0
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        holdingRightMouse = false
        lockedTarget = nil
    end
end)

-- Find Closest Player
local function getClosestTarget()
    local closest = nil
    local shortest = aimbotDistance

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= lp and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = player.Character.HumanoidRootPart
            local distance = (lp.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
            if distance < shortest and player.Character:FindFirstChild(aimPart) then
                shortest = distance
                closest = player
            end
        end
    end

    return closest
end

-- Aimbot Loop
RunService.RenderStepped:Connect(function(dt)
    if not aimbotEnabled or not holdingRightMouse then return end

    local mouseDelta = UserInputService:GetMouseDelta()
    local isMouseStill = (math.abs(mouseDelta.X) + math.abs(mouseDelta.Y)) < 1

    if isMouseStill then
        stillTime += dt
    else
        stillTime = 0
    end

    -- Get closest target
    local target = getClosestTarget()
    if target and target.Character then
        local part = target.Character:FindFirstChild(aimPart)
        if part then
            lockedTarget = target

            -- Hard lock only if mouse is still for X time
            if stillTime > lockDelay then
                local headPos = part.Position
                local cam = Workspace.CurrentCamera
                cam.CFrame = CFrame.new(cam.CFrame.Position, headPos)
            end
        end
    end
end)

-- Anti-Stamina Drain (Constant refill + interception)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer

local function keepStaminaFull()
    local char = lp.Character or lp.CharacterAdded:Wait()
    local stamina = char:FindFirstChild("Stamina") or lp:FindFirstChild("Stamina")
    if stamina and stamina:IsA("NumberValue") then
        -- Refill loop
        RunService.RenderStepped:Connect(function()
            stamina.Value = stamina.MaxValue or 100
        end)

        -- Prevent server changes
        stamina:GetPropertyChangedSignal("Value"):Connect(function()
            if stamina.Value < (stamina.MaxValue or 100) then
                stamina.Value = stamina.MaxValue or 100
            end
        end)
    end
end

lp.CharacterAdded:Connect(keepStaminaFull)
keepStaminaFull()


-- Character Reset
lp.CharacterAdded:Connect(function(newChar)
    chr = newChar
    hum = chr:WaitForChild("Humanoid")
end)
